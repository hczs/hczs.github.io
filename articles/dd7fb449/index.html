<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="description" content="一个语音克隆，支持微调的 TTS 工具，还支持流式 TTS API 接口。"><meta property="og:type" content="article"><meta property="og:title" content="GPT-SoVITS 语音克隆教程"><meta property="og:url" content="https://www.powercheng.fun/articles/dd7fb449/index.html"><meta property="og:site_name" content="Caiden&#39;s Blog"><meta property="og:description" content="一个语音克隆，支持微调的 TTS 工具，还支持流式 TTS API 接口。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754965661086-4d64ec2f-3e22-4696-a9f5-15a0d9cdd281-5418808.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754965707903-a4a739d8-688c-47be-91d3-e514ed15d729-5418830.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754965871286-be85d54f-be27-4e67-a92e-91a1b2f3eda2-5418850.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754966041561-984bbb37-9ea0-4ab6-8bf0-50bc3d2a1457-5418870.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754966136938-997d5aeb-7a3a-40a1-891a-5d8a4405b801-5418889.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754979616733-7d5169a9-1947-4f63-9493-225f1f7b8e94-5418947.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754981612397-d55fcbce-64bc-481a-98a5-ef78f6909fd8-5419211.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754981681462-15b5a7d6-e6e4-4313-96ae-c1e6bfe09ca9-5419228.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754981744335-c4f2b8af-8e0a-4b5a-834c-dc109fdfccaf-5419245.png"><meta property="og:image" content="https://www.powercheng.fun/articles/dd7fb449/1754989905823-a4cc3748-297d-4551-b7a7-1eadb730f7b8-5419311.png"><meta property="article:published_time" content="2025-08-17T08:06:15.000Z"><meta property="article:modified_time" content="2025-11-19T03:04:36.681Z"><meta property="article:author" content="Caiden Hou"><meta property="article:tag" content="语音克隆"><meta property="article:tag" content="TTS"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.powercheng.fun/articles/dd7fb449/1754965661086-4d64ec2f-3e22-4696-a9f5-15a0d9cdd281-5418808.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="stylesheet" href="https://gw.alipayobjects.com/os/k/font/lxgwwenkaiscreenr.css"><title>GPT-SoVITS 语音克隆教程</title><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/true" title="Caiden&#39;s Blog" type="application/atom+xml"><meta name="generator" content="Hexo 5.4.0"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" aria-label="顶部" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa-solid fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">首页</a></li><li><a href="/archives/">文章</a></li><li><a href="/categories/">分类</a></li><li><a href="/search/">搜索</a></li><li><a href="/about/">关于</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" aria-label="上一篇" href="/articles/15b3709a/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" aria-label="下一篇" href="/articles/2bf26df/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" aria-label="返回顶部" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">上一篇</span> <span id="i-next" class="info" style="display:none">下一篇</span> <span id="i-top" class="info" style="display:none">返回顶部</span> <span id="i-share" class="info" style="display:none">分享文章</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.powercheng.fun/articles/dd7fb449/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://twitter.com/share?url=https://www.powercheng.fun/articles/dd7fb449/&text=GPT-SoVITS 语音克隆教程"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.powercheng.fun/articles/dd7fb449/&is_video=false&description=GPT-SoVITS 语音克隆教程"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=GPT-SoVITS 语音克隆教程&body=Check out this article: https://www.powercheng.fun/articles/dd7fb449/" rel="external nofollow noreferrer"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://getpocket.com/save?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://reddit.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://digg.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" href="http://www.tumblr.com/share/link?url=https://www.powercheng.fun/articles/dd7fb449/&name=GPT-SoVITS 语音克隆教程&description=&lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css&#34; /&gt;&lt;div class=&#34;.article-gallery&#34;&gt;&lt;p&gt;一个语音克隆，支持微调的 TTS 工具，还支持流式 TTS API 接口。&lt;/p&gt;"><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.powercheng.fun/articles/dd7fb449/&t=GPT-SoVITS 语音克隆教程"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">1. 系统环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2. 项目安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8-amp-%E5%BE%AE%E8%B0%83"><span class="toc-number">3.</span> <span class="toc-text">3. 启动 &amp; 微调</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 项目启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%95%B0%E6%8D%AE%E9%9B%86%E5%87%86%E5%A4%87"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 数据集准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%BE%AE%E8%B0%83"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 微调</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E8%AE%AD%E7%BB%83%E9%9B%86%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 训练集格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%BE%AE%E8%B0%83%E8%AE%AD%E7%BB%83"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2. 微调训练</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%8E%A8%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">4. 推理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-API-%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">5. API 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%90%AF%E5%8A%A8"><span class="toc-number">5.1.</span> <span class="toc-text">5.1. 启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.</span> <span class="toc-text">5.2. 接口文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-TTS-%E6%8E%A5%E5%8F%A3%EF%BC%88GET%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">5.3. TTS 接口（GET）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%B5%81%E5%BC%8F-TTS-%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.4.</span> <span class="toc-text">5.4. 流式 TTS 接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="toc-number">6.</span> <span class="toc-text">6. 存在问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%BF%85%E9%A1%BB%E5%BE%97%E4%B8%8A%E4%BC%A0%E5%8F%82%E8%80%83%E9%9F%B3%E9%A2%91"><span class="toc-number">6.1.</span> <span class="toc-text">6.1. 必须得上传参考音频</span></a></li></ol></li></ol></div></span></div><div class="content index py4"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle p-name" itemprop="name headline">GPT-SoVITS 语音克隆教程</h1><div class="meta"><div class="postdate"><time datetime="2025-08-17T08:06:15.000Z" class="dt-published" itemprop="datePublished">2025-08-17</time> (Updated: <time datetime="2025-11-19T03:04:36.681Z" class="dt-updated" itemprop="dateModified">2025-11-19</time>)</div><div class="article-category"><i class="fa-solid fa-archive"></i> <a class="category-link" href="/categories/AI/">AI</a></div><div class="article-tag"><i class="fa-solid fa-tag"></i> <a class="p-category" href="/tags/TTS/" rel="tag">TTS</a>, <a class="p-category" href="/tags/%E8%AF%AD%E9%9F%B3%E5%85%8B%E9%9A%86/" rel="tag">语音克隆</a></div></div></header><div class="content e-content" itemprop="articleBody"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css"><div class=".article-gallery"><p>一个语音克隆，支持微调的 TTS 工具，还支持流式 TTS API 接口。</p><span id="more"></span><h1 id="1-系统环境"><a href="#1-系统环境" class="headerlink" title="1. 系统环境"></a>1. 系统环境</h1><p>操作系统：Ubuntu 22.04<br>是在 ucloud 租的 GPU 服务器，4090 48G 显存魔改版</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">(GPTSoVits) ubuntu@10-60-55-82:~/hou/GPT-SoVITS$ neofetch</span><br><span class="line">            .-/+oossssoo+/-.</span><br><span class="line">        `:+ssssssssssssssssss+:`</span><br><span class="line">      -+ssssssssssssssssssyyssss+-         ubuntu@10-60-55-82</span><br><span class="line">    .ossssssssssssssssssdMMMNysssso.       ------------------</span><br><span class="line">   /ssssssssssshdmmNNmmyNMMMMhssssss/      OS: Ubuntu 22.04.4 LTS x86_64</span><br><span class="line">  +ssssssssshmydMMMMMMMNddddyssssssss+     Host: KVM UCLOUD 1.0.0 O PC (i440FX + PIIX, 1996)</span><br><span class="line"> /sssssssshNMMMyhhyyyyhmNMMMNhssssssss/    Kernel: 5.15.0-113-generic</span><br><span class="line">.ssssssssdMMMNhsssssssssshNMMMdssssssss.   Uptime: 5 days, 46 mins</span><br><span class="line">+sssshhhyNMMNyssssssssssssyNMMMysssssss+   Packages: 1892 (dpkg), 7 (snap)</span><br><span class="line">ossyNMMMNyMMhsssssssssssssshmmmhssssssso   Shell: bash 5.1.16</span><br><span class="line">ossyNMMMNyMMhsssssssssssssshmmmhssssssso   Terminal: node</span><br><span class="line">+sssshhhyNMMNyssssssssssssyNMMMysssssss+   CPU: INTEL XEON GOLD 6530 (16) @ 2.100GHz</span><br><span class="line">.ssssssssdMMMNhsssssssssshNMMMdssssssss.   GPU: NVIDIA 00:03.0 NVIDIA Corporation Device 2684</span><br><span class="line"> /sssssssshNMMMyhhyyyyhdNMMMNhssssssss/    Memory: 26044MiB / 96553MiB</span><br><span class="line">  +sssssssssdmydMMMMMMMMddddyssssssss+</span><br><span class="line">   /ssssssssssshdmNNNNmyNMMMMhssssss/</span><br><span class="line">    .ossssssssssssssssssdMMMNysssso.</span><br><span class="line">      -+sssssssssssssssssyyyssss+-</span><br><span class="line">        `:+ssssssssssssssssss+:`</span><br><span class="line">            .-/+oossssoo+/-.</span><br><span class="line"></span><br><span class="line">(GPTSoVits) ubuntu@10-60-55-82:~/hou/GPT-SoVITS$ nvidia-smi</span><br><span class="line">Tue Aug 12 09:29:00 2025</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 570.133.07             Driver Version: 570.133.07     CUDA Version: 12.8     |</span><br><span class="line">|-----------------------------------------+------------------------+----------------------+</span><br><span class="line">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                                         |                        |               MIG M. |</span><br><span class="line">|=========================================+========================+======================|</span><br><span class="line">|   0  NVIDIA GeForce RTX 4090        Off |   00000000:00:03.0 Off |                  Off |</span><br><span class="line">| 63%   29C    P8             24W /  450W |   10430MiB /  49140MiB |      0%      Default |</span><br><span class="line">|                                         |                        |                  N/A |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                              |</span><br><span class="line">|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |</span><br><span class="line">|        ID   ID                                                               Usage      |</span><br><span class="line">|=========================================================================================|</span><br><span class="line">|    0   N/A  N/A          525763      C   ...da/envs/python310/bin/python3       2116MiB |</span><br><span class="line">|    0   N/A  N/A          526094      C   python                                  674MiB |</span><br><span class="line">|    0   N/A  N/A          526095      C   python                                  688MiB |</span><br><span class="line">|    0   N/A  N/A          526111      C   python                                 4326MiB |</span><br><span class="line">|    0   N/A  N/A          526205      C   ...t/build/bin/funasr-wss-server       2596MiB |</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h1 id="2-项目安装"><a href="#2-项目安装" class="headerlink" title="2. 项目安装"></a>2. 项目安装</h1><p>项目克隆到本地后，需要安装项目依赖和下载模型文件，直接使用 <code>install.sh</code>即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建虚拟环境</span></span><br><span class="line">conda create -n GPTSoVits python=3.10</span><br><span class="line">conda activate GPTSoVits</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">(GPTSoVits) ubuntu@10-60-55-82:~/hou/GPT-SoVITS$ bash install.sh --device CU128 --<span class="built_in">source</span> HF-Mirror</span><br><span class="line">[INFO]: Detected system: Linux 5.15.0-113-generic x86_64</span><br><span class="line">[INFO]: Detected GCC Version: 11</span><br><span class="line">[INFO]: Skip Installing GCC &amp; G++ From Conda-Forge</span><br><span class="line">[INFO]: Installing libstdcxx-ng From Conda-Forge</span><br><span class="line">[SUCCESS]: libstdcxx-ng=11 Installed...</span><br><span class="line">[INFO]: Installing FFmpeg &amp; CMake...</span><br><span class="line">[SUCCESS]: FFmpeg &amp; CMake Installed</span><br><span class="line">[INFO]: Installing unzip...</span><br><span class="line">[SUCCESS]: unzip Installed</span><br><span class="line">[INFO]: Download Model From HuggingFace-Mirror</span><br><span class="line">[INFO]: Downloading Pretrained Models...</span><br><span class="line">[SUCCESS]: Pretrained Models Downloaded</span><br><span class="line">[INFO]: Downloading G2PWModel..</span><br><span class="line">[SUCCESS]: G2PWModel Downloaded</span><br><span class="line">[INFO]: Checking For Nvidia Driver Installation...</span><br><span class="line">\033[1;32m[INFO]: \033[0mNvidia Driver Founded</span><br><span class="line">[INFO]: Installing PyTorch For CUDA 12.8...</span><br><span class="line">[SUCCESS]: PyTorch Installed</span><br><span class="line">[INFO]: Installing Python Dependencies From requirements.txt...</span><br><span class="line">[SUCCESS]: Python Dependencies Installed</span><br><span class="line">[INFO]: Downloading NLTK Data...</span><br><span class="line">[SUCCESS]: NLTK Data Downloaded</span><br><span class="line">[INFO]: Downloading Open JTalk Dict...</span><br><span class="line">[SUCCESS]: Open JTalk Dic Downloaded</span><br><span class="line">[SUCCESS]: Installation Completed</span><br></pre></td></tr></table></figure><h1 id="3-启动-amp-微调"><a href="#3-启动-amp-微调" class="headerlink" title="3. 启动 &amp; 微调"></a>3. 启动 &amp; 微调</h1><h2 id="3-1-项目启动"><a href="#3-1-项目启动" class="headerlink" title="3.1 项目启动"></a>3.1 项目启动</h2><p>在项目根目录下启动 web 界面，使用中文</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python webui.py zh_CN</span><br></pre></td></tr></table></figure><h2 id="3-2-数据集准备"><a href="#3-2-数据集准备" class="headerlink" title="3.2 数据集准备"></a>3.2 数据集准备</h2><p>准备好 wav 格式的语音数据集和对应的文字</p><p>准备 dataset.list 文件</p><p>文件格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语音路径 | 说话人名称 | 语音语言 | 语音内容</span><br></pre></td></tr></table></figure><p>我的文件内容：</p><p>准备了六条纳西妲的语音数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/1.wav|naxida|zh|小猫也想变成狐狸，但它尾巴太细小，又长不出富有色彩的皮毛。其他狐狸见了，安慰道：就算如此，你也是我们的同伴。</span><br><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/2.wav|naxida|zh|怪兽厌恶这种美满，在山中点起一把火。动物们异常惊慌。为了扑灭大火，它们必须做出牺牲。</span><br><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/3.wav|naxida|zh|一只灰色的狐狸站起来，与怪兽交谈。它说：你是如此聪明，一定能想到帮助我们的办法。</span><br><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/4.wav|naxida|zh|怪兽将那颗水珠交给小猫，告诉它：大家已经想好让你牺牲了。带上这个，去为你的狐狸同伴而死吧。</span><br><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/5.wav|naxida|zh|它们说好要相依为命，可小鸟的寿命太短，一下就没了呼吸。小猫埋葬它之后，便离开了那座山。</span><br><span class="line">/home/ubuntu/hou/GPT-SoVITS/data/gpt/6.wav|naxida|zh|…它再也没有爱过山中任何一片树叶与任何一只动物。它流浪在每一个夜晚，对着月光磨牙。</span><br></pre></td></tr></table></figure><h2 id="3-3-微调"><a href="#3-3-微调" class="headerlink" title="3.3 微调"></a>3.3 微调</h2><h3 id="3-3-1-训练集格式化"><a href="#3-3-1-训练集格式化" class="headerlink" title="3.3.1 训练集格式化"></a>3.3.1 训练集格式化</h3><ol><li>填写实验名称</li><li>填写 list 文件绝对路径</li><li>训练集格式化一键三连，然后观察右下角的输出，等待出现一键三连完成提示</li></ol><a href="/articles/dd7fb449/1754965661086-4d64ec2f-3e22-4696-a9f5-15a0d9cdd281-5418808.png" class="gallery-item"><img src="/articles/dd7fb449/1754965661086-4d64ec2f-3e22-4696-a9f5-15a0d9cdd281-5418808.png" title="image.png"></a><a href="/articles/dd7fb449/1754965707903-a4a739d8-688c-47be-91d3-e514ed15d729-5418830.png" class="gallery-item"><img src="/articles/dd7fb449/1754965707903-a4a739d8-688c-47be-91d3-e514ed15d729-5418830.png" title="image.png"></a><p>格式化后，会在 logs/实验名称 这个文件夹下有对应的数据</p><a href="/articles/dd7fb449/1754965871286-be85d54f-be27-4e67-a92e-91a1b2f3eda2-5418850.png" class="gallery-item"><img src="/articles/dd7fb449/1754965871286-be85d54f-be27-4e67-a92e-91a1b2f3eda2-5418850.png" title="image.png"></a><h3 id="3-3-2-微调训练"><a href="#3-3-2-微调训练" class="headerlink" title="3.3.2. 微调训练"></a>3.3.2. 微调训练</h3><ol><li>先点击开启 SoVITS 训练，等待出现 SoVITS 训练完成后</li><li>再点击开启 GPT 训练，等待训练完成</li></ol><a href="/articles/dd7fb449/1754966041561-984bbb37-9ea0-4ab6-8bf0-50bc3d2a1457-5418870.png" class="gallery-item"><img src="/articles/dd7fb449/1754966041561-984bbb37-9ea0-4ab6-8bf0-50bc3d2a1457-5418870.png" title="image.png"></a><p>训练完成示意图</p><a href="/articles/dd7fb449/1754966136938-997d5aeb-7a3a-40a1-891a-5d8a4405b801-5418889.png" class="gallery-item"><img src="/articles/dd7fb449/1754966136938-997d5aeb-7a3a-40a1-891a-5d8a4405b801-5418889.png" title="image.png"></a><h1 id="4-推理"><a href="#4-推理" class="headerlink" title="4. 推理"></a>4. 推理</h1><p>点击开启 TTS 推理，会跳出如下页面：</p><ol><li>先选择模型</li><li>上传参考音频和对应的参考文本</li><li>填写要合成的文本</li><li>点击合成语音</li></ol><a href="/articles/dd7fb449/1754979616733-7d5169a9-1947-4f63-9493-225f1f7b8e94-5418947.png" class="gallery-item"><img src="/articles/dd7fb449/1754979616733-7d5169a9-1947-4f63-9493-225f1f7b8e94-5418947.png" title="image.png"></a><h1 id="5-API-模式"><a href="#5-API-模式" class="headerlink" title="5. API 模式"></a>5. API 模式</h1><h2 id="5-1-启动"><a href="#5-1-启动" class="headerlink" title="5.1. 启动"></a>5.1. 启动</h2><p>微调好模型肯定需要 API 调用</p><p>执行 api.py 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python api.py -s SoVITS_weights_v2ProPlus/naxida-v2proplus_e8_s48.pth  -g GPT_weights_v2ProPlus/naxida-v2proplus-e15.ckpt</span><br></pre></td></tr></table></figure><p>-s 是指定 SoVITS 模型</p><p>-g 是指定 gpt 模型</p><p>执行完成后这就代表成功启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(GPTSoVits) ubuntu@10-60-55-82:~/hou/GPT-SoVITS$ python api.py -s SoVITS_weights_v2ProPlus/naxida-v2proplus_e8_s48.pth  -g GPT_weights_v2ProPlus/naxida-v2proplus-e15</span><br><span class="line">.ckpt</span><br><span class="line">INFO:     未指定默认参考音频</span><br><span class="line">INFO:     半精: True</span><br><span class="line">INFO:     编码格式: wav</span><br><span class="line">INFO:     数据类型: int16</span><br><span class="line">INFO:     模型版本: v2ProPlus</span><br><span class="line">INFO:     Started server process [947648]</span><br><span class="line">INFO:     Waiting <span class="keyword">for</span> application startup.</span><br><span class="line">INFO:     Application startup complete.</span><br><span class="line">INFO:     Uvicorn running on http://0.0.0.0:9880 (Press CTRL+C to quit)</span><br></pre></td></tr></table></figure><h2 id="5-2-接口文档"><a href="#5-2-接口文档" class="headerlink" title="5.2. 接口文档"></a>5.2. 接口文档</h2><p>访问网址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:9880/docs">http://localhost:9880/docs</a></p><p>这里是接口文档</p><a href="/articles/dd7fb449/1754981612397-d55fcbce-64bc-481a-98a5-ef78f6909fd8-5419211.png" class="gallery-item"><img src="/articles/dd7fb449/1754981612397-d55fcbce-64bc-481a-98a5-ef78f6909fd8-5419211.png" title="image.png"></a><h2 id="5-3-TTS-接口（GET）"><a href="#5-3-TTS-接口（GET）" class="headerlink" title="5.3. TTS 接口（GET）"></a>5.3. TTS 接口（GET）</h2><p>现在可以通过 api 文字转语音了！</p><p>主要填写三部分</p><ol><li>参考音频、文本和语言</li><li>要生成的文本和语言</li><li>默认推理参数</li></ol><a href="/articles/dd7fb449/1754981681462-15b5a7d6-e6e4-4313-96ae-c1e6bfe09ca9-5419228.png" class="gallery-item"><img src="/articles/dd7fb449/1754981681462-15b5a7d6-e6e4-4313-96ae-c1e6bfe09ca9-5419228.png" title="image.png"></a><p>点击 execute 之后，就可以看到生成的语音文件了</p><a href="/articles/dd7fb449/1754981744335-c4f2b8af-8e0a-4b5a-834c-dc109fdfccaf-5419245.png" class="gallery-item"><img src="/articles/dd7fb449/1754981744335-c4f2b8af-8e0a-4b5a-834c-dc109fdfccaf-5419245.png" title="image.png"></a><h2 id="5-4-流式-TTS-接口"><a href="#5-4-流式-TTS-接口" class="headerlink" title="5.4. 流式 TTS 接口"></a>5.4. 流式 TTS 接口</h2><p>启动的时候添加流式的参数即可</p><p>-sm：流式返回模式, 默认不启用, 可以设置为如下值”close”,”c”, “normal”,”n”, “keepalive”,”k”</p><p>-mt：返回的音频编码格式, 流式默认ogg, 非流式默认wav, “wav”, “ogg”, “aac”</p><p>测试 ogg，浏览器运行报错了，所以使用 aac 格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python api.py -s SoVITS_weights_v2ProPlus/naxida-v2proplus_e8_s48.pth  -g GPT_weights_v2ProPlus/naxida-v2proplus-e15.ckpt -sm k -mt aac</span><br></pre></td></tr></table></figure><p>配置跨域，修改 api.py 文件</p><p>在 main 上面添加如下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增代码</span></span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.cors <span class="keyword">import</span> CORSMiddleware</span><br><span class="line"></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_headers=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是原有代码</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=host, port=port, workers=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>可以使用 post 接口来请求，以下是流式测试用的 html 代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>流式 TTS 播放器 (POST JSON)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-family</span>: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, <span class="string">&quot;Helvetica Neue&quot;</span>, Arial;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background</span>: <span class="number">#0f172a</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#e6eef8</span></span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.card</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background</span>: <span class="number">#111827</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">6px</span> <span class="number">18px</span> <span class="built_in">rgba</span>(<span class="number">2</span>, <span class="number">6</span>, <span class="number">23</span>, .<span class="number">6</span>);</span></span><br><span class="line"><span class="css">            <span class="attribute">max-width</span>: <span class="number">820px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin</span>: auto</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">textarea</span>,</span></span><br><span class="line"><span class="css">        <span class="selector-tag">input</span>,</span></span><br><span class="line"><span class="css">        select,</span></span><br><span class="line"><span class="css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-top</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#23303b</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background</span>: <span class="number">#071022</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#e6eef8</span></span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="css">            <span class="attribute">background</span>: <span class="number">#1e293b</span></span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.row</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            gap: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">flex-wrap</span>: wrap</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.log</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-top</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background</span>: <span class="number">#04101a</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">120px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">overflow</span>: auto;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-size</span>: <span class="number">13px</span></span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>流式 TTS 播放器 (POST JSON)<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>TTS 接口 URL<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;ttsUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;http://127.0.0.1:9880&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Refer WAV 路径<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;referWav&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/home/ubuntu/hou/GPT-SoVITS/data/gpt/ref.wav&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Prompt 文本<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;promptText&quot;</span>&gt;</span>我还有些事要研究，你们先转换一下心情吧。<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Prompt 语言<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;promptLang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zh&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>合成文本<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span>&gt;</span>欢迎使用我们的语音合成服务。<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>文本语言<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;textLang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zh&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>切分标点<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;cutPunc&quot;</span> <span class="attr">value</span>=<span class="string">&quot;，。！？&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;mediaType&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;ogg&quot;</span>&gt;</span>ogg<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;aac&quot;</span>&gt;</span>aac<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;wav&quot;</span>&gt;</span>wav<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;startBtn&quot;</span>&gt;</span>开始播放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;stopBtn&quot;</span> <span class="attr">disabled</span>&gt;</span>停止<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">audio</span> <span class="attr">id</span>=<span class="string">&quot;player&quot;</span> <span class="attr">controls</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;margin-top:10px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;log&quot;</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> logEl = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;log&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">...args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(...args);</span></span><br><span class="line"><span class="javascript">            logEl.innerText += args.join(<span class="string">&#x27; &#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            logEl.scrollTop = logEl.scrollHeight;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> controller = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> reader = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> mediaSource = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> sourceBuffer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> queue = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> audioUrl = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> playingBlobParts = [];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> startBtn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;startBtn&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> stopBtn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;stopBtn&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> player = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;player&#x27;</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        startBtn.addEventListener(<span class="string">&#x27;click&#x27;</span>, startStreaming);</span></span><br><span class="line"><span class="javascript">        stopBtn.addEventListener(<span class="string">&#x27;click&#x27;</span>, stopStreaming);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">startStreaming</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            stopStreaming();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> baseUrl = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;ttsUrl&#x27;</span>).value.trim();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> mediaType = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;mediaType&#x27;</span>).value;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> bodyData = &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">refer_wav_path</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;referWav&#x27;</span>).value.trim(),</span></span><br><span class="line"><span class="javascript">                <span class="attr">prompt_text</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;promptText&#x27;</span>).value,</span></span><br><span class="line"><span class="javascript">                <span class="attr">prompt_language</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;promptLang&#x27;</span>).value.trim(),</span></span><br><span class="line"><span class="javascript">                <span class="attr">text</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;text&#x27;</span>).value,</span></span><br><span class="line"><span class="javascript">                <span class="attr">text_language</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;textLang&#x27;</span>).value.trim(),</span></span><br><span class="line"><span class="javascript">                <span class="attr">cut_punc</span>: <span class="built_in">document</span>.getElementById(<span class="string">&#x27;cutPunc&#x27;</span>).value</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            log(<span class="string">&#x27;POST 请求:&#x27;</span>, baseUrl, bodyData);</span></span><br><span class="line"><span class="javascript">            controller = <span class="keyword">new</span> AbortController();</span></span><br><span class="line"><span class="javascript">            queue = [];</span></span><br><span class="line"><span class="javascript">            playingBlobParts = [];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="string">&#x27;MediaSource&#x27;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; mediaType === <span class="string">&#x27;ogg&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">                setupMediaSource(<span class="string">&#x27;audio/ogg; codecs=&quot;opus&quot;&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                fetchAndStreamPOST(baseUrl, bodyData, controller.signal, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&#x27;MediaSource&#x27;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; mediaType === <span class="string">&#x27;aac&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">                setupMediaSource(<span class="string">&#x27;audio/aac&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                fetchAndStreamPOST(baseUrl, bodyData, controller.signal, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                fetchAndPlayAsBlobPOST(baseUrl, bodyData, controller.signal);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">setupMediaSource</span>(<span class="params">mime</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            cleanupMediaSource();</span></span><br><span class="line"><span class="javascript">            mediaSource = <span class="keyword">new</span> MediaSource();</span></span><br><span class="line"><span class="javascript">            audioUrl = URL.createObjectURL(mediaSource);</span></span><br><span class="line"><span class="javascript">            player.src = audioUrl;</span></span><br><span class="line"><span class="javascript">            mediaSource.addEventListener(<span class="string">&#x27;sourceopen&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">try</span> &#123; sourceBuffer = mediaSource.addSourceBuffer(mime); &#125; <span class="keyword">catch</span> (e) &#123; log(<span class="string">&#x27;addSourceBuffer 失败:&#x27;</span>, e); <span class="keyword">return</span>; &#125;</span></span><br><span class="line"><span class="javascript">                sourceBuffer.mode = <span class="string">&#x27;sequence&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                sourceBuffer.addEventListener(<span class="string">&#x27;updateend&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (queue.length &gt; <span class="number">0</span> &amp;&amp; !sourceBuffer.updating) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">const</span> chunk = queue.shift();</span></span><br><span class="line"><span class="javascript">                        sourceBuffer.appendBuffer(chunk);</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (queue.length === <span class="number">0</span> &amp;&amp; mediaSource.readyState === <span class="string">&#x27;open&#x27;</span> &amp;&amp; !reader) &#123;</span></span><br><span class="line"><span class="javascript">                        mediaSource.endOfStream();</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (queue.length &gt; <span class="number">0</span> &amp;&amp; !sourceBuffer.updating) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">const</span> chunk = queue.shift();</span></span><br><span class="line"><span class="javascript">                    sourceBuffer.appendBuffer(chunk);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">                player.play().catch(<span class="function">() =&gt;</span> &#123; &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">cleanupMediaSource</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (sourceBuffer) &#123; <span class="keyword">try</span> &#123; <span class="keyword">if</span> (mediaSource &amp;&amp; mediaSource.readyState === <span class="string">&#x27;open&#x27;</span>) mediaSource.removeSourceBuffer(sourceBuffer); &#125; <span class="keyword">catch</span> (e) &#123; &#125; sourceBuffer = <span class="literal">null</span>; &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (mediaSource) &#123; <span class="keyword">try</span> &#123; URL.revokeObjectURL(audioUrl); &#125; <span class="keyword">catch</span> (e) &#123; &#125; mediaSource = <span class="literal">null</span>; &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndStreamPOST</span>(<span class="params">url, body, signal, useMediaSource</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, signal, <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;, <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(body) &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!resp.ok) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;HTTP &#x27;</span> + resp.status);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> ct = resp.headers.get(<span class="string">&#x27;content-type&#x27;</span>) || <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (ct.includes(<span class="string">&#x27;application/json&#x27;</span>)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Server error: &#x27;</span> + <span class="built_in">JSON</span>.stringify(<span class="keyword">await</span> resp.json())); &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            reader = resp.body.getReader();</span></span><br><span class="line"><span class="javascript">            stopBtn.disabled = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            startBtn.disabled = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.read();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!value) <span class="keyword">continue</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> chunk = value.buffer.slice(value.byteOffset, value.byteOffset + value.byteLength);</span></span><br><span class="line"><span class="javascript">                playingBlobParts.push(chunk);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (useMediaSource &amp;&amp; sourceBuffer) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (sourceBuffer.updating || queue.length &gt; <span class="number">0</span>) &#123; queue.push(chunk); &#125;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">else</span> &#123; <span class="keyword">try</span> &#123; sourceBuffer.appendBuffer(chunk); &#125; <span class="keyword">catch</span> (e) &#123; queue.push(chunk); &#125; &#125;</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            log(<span class="string">&#x27;流读取结束&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            reader = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            stopBtn.disabled = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">            startBtn.disabled = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!useMediaSource) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> mime = resp.headers.get(<span class="string">&#x27;content-type&#x27;</span>) || <span class="string">&#x27;audio/ogg&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob(playingBlobParts, &#123; <span class="attr">type</span>: mime &#125;);</span></span><br><span class="line"><span class="javascript">                player.src = URL.createObjectURL(blob);</span></span><br><span class="line"><span class="javascript">                player.play().catch(<span class="function">() =&gt;</span> &#123; &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndPlayAsBlobPOST</span>(<span class="params">url, body, signal</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            log(<span class="string">&#x27;fallback -&gt; blob 下载&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url, &#123; <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, signal, <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;, <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(body) &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!resp.ok) &#123; log(<span class="string">&#x27;HTTP error&#x27;</span>, resp.status); <span class="keyword">return</span>; &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> ct = resp.headers.get(<span class="string">&#x27;content-type&#x27;</span>) || <span class="string">&#x27;audio/ogg&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> ab = <span class="keyword">await</span> resp.arrayBuffer();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([ab], &#123; <span class="attr">type</span>: ct &#125;);</span></span><br><span class="line"><span class="javascript">            player.src = URL.createObjectURL(blob);</span></span><br><span class="line"><span class="javascript">            player.play().catch(<span class="function">() =&gt;</span> &#123; &#125;);</span></span><br><span class="line"><span class="javascript">            stopBtn.disabled = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            startBtn.disabled = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">stopStreaming</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">try</span> &#123; <span class="keyword">if</span> (controller) controller.abort(); &#125; <span class="keyword">catch</span> (e) &#123; &#125;</span></span><br><span class="line"><span class="javascript">            controller = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (reader) &#123; <span class="keyword">try</span> &#123; reader.cancel(); &#125; <span class="keyword">catch</span> (e) &#123; &#125; reader = <span class="literal">null</span>; &#125;</span></span><br><span class="line"><span class="javascript">            cleanupMediaSource();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">try</span> &#123; <span class="keyword">if</span> (player.src &amp;&amp; player.src.startsWith(<span class="string">&#x27;blob:&#x27;</span>)) URL.revokeObjectURL(player.src); &#125; <span class="keyword">catch</span> (e) &#123; &#125;</span></span><br><span class="line"><span class="javascript">            player.pause();</span></span><br><span class="line"><span class="javascript">            stopBtn.disabled = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">            startBtn.disabled = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">            log(<span class="string">&#x27;已停止&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试效果</p><a href="/articles/dd7fb449/1754989905823-a4cc3748-297d-4551-b7a7-1eadb730f7b8-5419311.png" class="gallery-item"><img src="/articles/dd7fb449/1754989905823-a4cc3748-297d-4551-b7a7-1eadb730f7b8-5419311.png" title="image.png"></a><p>测试文本</p><blockquote><p>各位听众，早上好！今天，我们将一起踏上一段奇妙的声音之旅——让文字在声波中绽放。<br>请闭上眼睛，想象自己正站在春日田野，微风拂过耳畔，带来淡淡花香；<br>远处传来布谷鸟的呼唤，“布——谷——布——谷”。此刻，阳光穿过云层，洒在湖面，泛起粼粼金光；<br>而你的心跳，也与这自然的节奏渐渐同频。愿这段声音，为你点亮一整天的好心情。</p></blockquote><p>155 字的情况下：</p><ul><li>非流式：10s 生成完毕</li><li>流式： 6s 后开始传输语音</li></ul><p>语音长度 37s</p><p>简单测试，仅供参考，测试显卡 NVIDIA GeForce RTX 4090 48G 显存</p><h1 id="6-存在问题"><a href="#6-存在问题" class="headerlink" title="6. 存在问题"></a>6. 存在问题</h1><h2 id="6-1-必须得上传参考音频"><a href="#6-1-必须得上传参考音频" class="headerlink" title="6.1. 必须得上传参考音频"></a>6.1. 必须得上传参考音频</h2><p>按照说明，理论上来说可以不填写参考音频和文本（可以打对勾无参考音频模式），使用微调后的模型来直接推理，但是试了 v1、v2、v2pro、v2proplus，v4 都必须得上传音频</p><p>其中 v4 是无法开启无参考音频模式</p><p>其他版本可以开启无参考音频模式，但是报错提示需要上传参考音频</p></div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>var options;"undefined"!=typeof lightGallery&&(options={selector:".gallery-item"},lightGallery(document.getElementsByClassName(".article-gallery")[0],options))</script></div></article><div class="blog-post-comments"><div id="disqus_thread"><noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">首页</a></li><li><a href="/archives/">文章</a></li><li><a href="/categories/">分类</a></li><li><a href="/search/">搜索</a></li><li><a href="/about/">关于</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">1. 系统环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2. 项目安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8-amp-%E5%BE%AE%E8%B0%83"><span class="toc-number">3.</span> <span class="toc-text">3. 启动 &amp; 微调</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 项目启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%95%B0%E6%8D%AE%E9%9B%86%E5%87%86%E5%A4%87"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 数据集准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%BE%AE%E8%B0%83"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 微调</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E8%AE%AD%E7%BB%83%E9%9B%86%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 训练集格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%BE%AE%E8%B0%83%E8%AE%AD%E7%BB%83"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2. 微调训练</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%8E%A8%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">4. 推理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-API-%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">5. API 模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%90%AF%E5%8A%A8"><span class="toc-number">5.1.</span> <span class="toc-text">5.1. 启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.</span> <span class="toc-text">5.2. 接口文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-TTS-%E6%8E%A5%E5%8F%A3%EF%BC%88GET%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">5.3. TTS 接口（GET）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%B5%81%E5%BC%8F-TTS-%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.4.</span> <span class="toc-text">5.4. 流式 TTS 接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="toc-number">6.</span> <span class="toc-text">6. 存在问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%BF%85%E9%A1%BB%E5%BE%97%E4%B8%8A%E4%BC%A0%E5%8F%82%E8%80%83%E9%9F%B3%E9%A2%91"><span class="toc-number">6.1.</span> <span class="toc-text">6.1. 必须得上传参考音频</span></a></li></ol></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.powercheng.fun/articles/dd7fb449/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://twitter.com/share?url=https://www.powercheng.fun/articles/dd7fb449/&text=GPT-SoVITS 语音克隆教程"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.powercheng.fun/articles/dd7fb449/&is_video=false&description=GPT-SoVITS 语音克隆教程"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=GPT-SoVITS 语音克隆教程&body=Check out this article: https://www.powercheng.fun/articles/dd7fb449/" rel="external nofollow noreferrer"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://getpocket.com/save?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://reddit.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="http://digg.com/submit?url=https://www.powercheng.fun/articles/dd7fb449/&title=GPT-SoVITS 语音克隆教程"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" href="http://www.tumblr.com/share/link?url=https://www.powercheng.fun/articles/dd7fb449/&name=GPT-SoVITS 语音克隆教程&description=&lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css&#34; /&gt;&lt;div class=&#34;.article-gallery&#34;&gt;&lt;p&gt;一个语音克隆，支持微调的 TTS 工具，还支持流式 TTS API 接口。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener external nofollow noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.powercheng.fun/articles/dd7fb449/&t=GPT-SoVITS 语音克隆教程"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2021-2025 Caiden Hou</div><div class="footer-right"><nav><ul><li><a href="/">首页</a></li><li><a href="/archives/">文章</a></li><li><a href="/categories/">分类</a></li><li><a href="/search/">搜索</a></li><li><a href="/about/">关于</a></li></ul></nav></div></footer></div><link rel="preload" href="/lib/font-awesome/css/all.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"></noscript><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">$(function(){$(".highlight table").before('<span class="btn-copy tooltipped tooltipped-sw" aria-label="复制到粘贴板！"><i class="fa-regular fa-clone"></i></span>'),new ClipboardJS(".btn-copy",{text:function(e){return Array.from(e.nextElementSibling.querySelectorAll(".code")).reduce((e,t)=>e+t.innerText+"\n","")}}).on("success",function(e){e.trigger.setAttribute("aria-label","复制成功！"),e.clearSelection()})})</script><script src="/js/main.js"></script><script type="text/javascript">var disqus_shortname="caidens-blog";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body></html>